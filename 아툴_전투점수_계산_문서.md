# 아이온2 아툴 전투 점수 계산 시스템 완전 분석

---

## 📋 목차

1. [전투 점수 개요](#1-전투-점수-개요)
2. [공격력 계산](#2-공격력-계산)
3. [피해 증폭 계산](#3-피해-증폭-계산)
4. [스킬 점수 계산](#4-스킬-점수-계산)
5. [전투 속도 계산](#5-전투-속도-계산)
6. [재사용 대기 시간 감소 계산](#6-재사용-대기-시간-감소-계산)
7. [치명타 계산](#7-치명타-계산)
8. [강타 계산](#8-강타-계산)
9. [완벽 계산](#9-완벽-계산)
10. [다단 히트 적중 계산](#10-다단-히트-적중-계산)
11. [최종 전투 점수 통합](#11-최종-전투-점수-통합)

---

## 1. 전투 점수 개요

### 1.1 핵심 공식

```javascript
최종 전투 점수 = 공격력 × 모든_스탯_기여도의_곱
```

### 1.2 계산 흐름

```
개별 스탯 계산 → 기여도 산출 → 곱연산 통합 → 최종 점수
```

---

## 2. 공격력 계산

### 2.1 기본 공식

```javascript
// 1단계: 베이스 공격력 (정수)
baseAttack = 데바니온 + 장비/장신구 + 초월정수

// 2단계: 퍼센트 배율
percentMultiplier = 초월% + 파괴% + 위력%

// 3단계: 최종 공격력
finalAttack = Math.floor(baseAttack × (1 + percentMultiplier/100)) + 아리엘PVE
```

### 2.2 수집 출처

| 출처 | 타입 | 설명 |
|------|------|------|
| 데바니온 (4개 보드) | 정수 | 네자칸, 루미엘, 시엘, 트리니엘 |
| 장비/장신구 기본 | 정수 | baseAttack + enhanceBonus |
| 초월 정수 | 정수 | 초월 레벨 × 30 |
| 아리엘 PVE | 정수 | PVE/보스 공격력 (별도 추가) |
| 초월 퍼센트 | 퍼센트 | 초월 레벨 × 1% |
| 파괴 스탯 | 퍼센트 | 파괴 스탯 × 0.2% |
| 위력 스탯 | 퍼센트 | 위력 스탯 × 0.1% |

### 2.3 공격력 % 캡 시스템

```javascript
CAP_LIMIT = 100%

// 캡 계산에 포함
총 캡% = 초월% + 파괴% + 위력% + 패시브스킬%

// 캡 초과 시 적용
if (총캡% > 100%) {
  cappedAttack = finalAttack × (1 + 100/100) / (1 + 총캡%/100)
}
```

**직업별 패시브 스킬:**
- 살성/검성/호법성: 레벨당 +1%
- 궁성/마도성: 레벨당 +1.5%
- 정령성: 레벨당 +1%

---

## 3. 피해 증폭 계산

### 3.1 4가지 피해 증폭 타입

1. **무기 피해 증폭**
2. **PVE 피해 증폭**
3. **피해 증폭 (일반)**
4. **치명타 피해 증폭**

### 3.2 기본 공식

```javascript
// 각 타입별 계산
타입별_최종% = 영혼각인% + 장비기본% + 마석변환% + 데바니온% + 아리엘% + 타이틀%

// 마석 정수 → 퍼센트 변환
퍼센트 = (마석정수 / 10) × 0.1%

// DPS 계산용 총합
총_피해증폭 = 무기피해증폭 + PVE피해증폭 + 일반피해증폭 + 치명타피해증폭
```

### 3.3 출처별 수집 가능 타입

| 출처 | 무기 | PVE | 일반 | 치명타 |
|------|------|-----|------|--------|
| 영혼 각인 (%) | ✅ | ✅ | ✅ | ✅ |
| 장비 기본 (%) | ✅ | ✅ | ❌ | ❌ |
| 마석 (정수) | ✅ | ✅ | ✅ | ✅ |
| 데바니온 (%) | ✅ | ✅ | ✅ | ✅ |
| 아리엘 (%) | ❌ | ✅ | ❌ | ❌ |
| 타이틀 (%) | ✅ | ✅ | ✅ | ❌ |

### 3.4 키워드 우선순위

```
구체적 키워드 우선:
"무기 피해 증폭" > "PVE 피해 증폭" > "치명타 피해 증폭" > "피해 증폭"
```

---

## 4. 스킬 점수 계산

### 4.1 3가지 카테고리

1. **액티브 스킬** (12개)
2. **패시브 스킬** (10개)
3. **스티그마** (레벨 높은 상위 4개)

### 4.2 스킬 점수 공식

```javascript
// 개별 스킬 점수
스킬점수 = (기본점수 + 보너스점수) × 중요도계수

// 기본 점수
기본점수 = 스킬레벨 × 1.5

// 보너스 점수 (마일스톤)
액티브: Lv8(+5), Lv12(+10), Lv16(+15), Lv20(+10)
패시브: 없음
스티그마: Lv5(+5), Lv10(+10), Lv15(+25), Lv20(+40)
```

### 4.3 중요도 계수

**스티그마:**
```javascript
중요도계수 = (해당스킬_평균레벨 / 최고스킬_평균레벨) × 1.5
최소값 = 0.2 (20%)
```

**액티브/패시브:**
```javascript
step = (200% - 20%) / (총스킬수 - 1)

1순위: 200%
2순위: 200% - step
3순위: 200% - step × 2
...
마지막순위: 20%
```

### 4.4 카테고리별 평균

```javascript
액티브점수 = (모든_액티브_스킬점수_합) / 12
패시브점수 = (모든_패시브_스킬점수_합) / 10
스티그마점수 = (상위4개_스킬점수_합) / 4

총_스킬점수 = 액티브점수 + 패시브점수 + 스티그마점수
```


---

## 5. 전투 속도 계산

### 5.1 수집 출처

| 출처 | 계산 방식 |
|------|----------|
| 영혼 각인 | 직접 합산 |
| 장신구 기본 옵션 | 직접 합산 |
| 시간 스탯 | 시간 × 0.2% |
| 데바니온 | 직접 합산 |
| 타이틀 | 직접 합산 |

### 5.2 DPS 계수 공식

```javascript
전투속도계수 = 1 / (1 - 전투속도%)

// 안전 장치
if (전투속도 >= 100% || 전투속도 <= 0%) {
  전투속도계수 = 1
}
```

### 5.3 딜 증가율

| 전투속도 | 계수 | 딜 증가 |
|---------|------|---------|
| 10% | 1.111 | +11.1% |
| 20% | 1.250 | +25.0% |
| 30% | 1.429 | +42.9% |
| 40% | 1.667 | +66.7% |
| 50% | 2.000 | +100.0% |


---

## 6. 재사용 대기 시간 감소 계산

### 6.1 수집 출처

| 출처 | 계산 방식 |
|------|----------|
| 타이틀 | 직접 합산 |
| 환상 스탯 | 환상 × 0.2% |
| 데바니온 | 직접 합산 |

### 6.2 DPS 계수 공식

```javascript
쿨타임감소계수 = 1 / (1 - 쿨타임감소%)

// 안전 장치
if (쿨타임감소 >= 100% || 쿨타임감소 <= 0%) {
  쿨타임감소계수 = 1
}
```

### 6.3 전투 점수 기여도

```javascript
COOLDOWN_EFFICIENCY = 0.7 // 효율 계수

이론적증가 = ((1 / (1 - 쿨타임감소%)) - 1) × 100
실제기여도 = 이론적증가 × 0.7
```


---

## 7. 치명타 계산

### 7.1 수집 출처

| 출처 | 타입 | 계산 방식 |
|------|------|----------|
| 무기/가더 기본 | 정수 | 직접 합산 |
| 영혼 각인 | 정수 | 직접 합산 |
| 마석 각인 | 정수 | 직접 합산 |
| 데바니온 (4개) | 정수 | 직접 합산 |
| 죽음 스탯 | 퍼센트 | 죽음 × 0.2% |
| 정확 스탯 | 퍼센트 | 정확 × 0.1% |

### 7.2 최종 계산 공식

```javascript
// 1단계: 정수 합산
총정수 = 기본옵션 + 영혼각인 + 마석 + 데바니온

// 2단계: 퍼센트 배율
퍼센트배율 = 1 + (죽음% + 정확%) / 100
최종정수 = Math.round(총정수 × 퍼센트배율)

// 3단계: 확률 변환 (중요!)
치명타확률(%) = (최종정수 × 0.7) / 10
```

### 7.3 치명타 피해 증폭 기여도

```javascript
BASE_CRITICAL_DAMAGE = 1.5
증폭데미지 = 1.5 + (치명타피해증폭% / 100)
p = 치명타확률% / 100

기본기댓값 = (1 - p) × 1 + p × 1.5
증폭기댓값 = (1 - p) × 1 + p × 증폭데미지

전투점수기여도 = ((증폭기댓값 / 기본기댓값) - 1) × 100
```


---

## 8. 강타 계산

### 8.1 수집 출처

| 출처 | 계산 방식 |
|------|----------|
| 타이틀 | 직접 퍼센트 |
| 지혜 스탯 | 지혜 × 0.1% × 2 |

### 8.2 최종 공식

```javascript
총강타% = 타이틀강타 + 지혜강타

// DPS 계수
강타계수 = (강타% / 100) × 1.0  // 2배 데미지 → 추가분 1.0
```


---

## 9. 완벽 계산

### 9.1 수집 출처

| 출처 | 계산 방식 |
|------|----------|
| 타이틀 | 직접 퍼센트 |
| 정의 스탯 | 정의 × 0.1% × 2 |
| 장신구 기본 | 직접 퍼센트 |

### 9.2 최종 공식

```javascript
총완벽% = 타이틀완벽 + 정의완벽 + 장신구완벽

// DPS 계수
완벽계수 = (완벽% / 100) × 0.25  // 1.25배 데미지 → 추가분 0.25
```

### 9.3 전투 점수 기여도

```javascript
기여도 = 완벽% × ((무기최대 - 무기최소) / (무기최대 + 무기최소))
```


---

## 10. 다단 히트 적중 계산

### 10.1 수집 출처

영혼 각인, 마석 각인, 데바니온에서 수집

### 10.2 4차 다항식 공식

```javascript
x = 다단히트확률% / 100
y = 11.1×x + 13.9×x² + 17.8×x³ + 23.9×x⁴

다단히트계수 = y / 100
```

**각 항의 의미:**
- 1차항 (11.1x): 1타 발동 (+11% 피해)
- 2차항 (13.9x²): 2타 발동 (+25% 피해)
- 3차항 (17.8x³): 3타 발동 (+43% 피해)
- 4차항 (23.9x⁴): 4타 발동 (+67% 피해)

### 10.3 전투 점수 기여도

```javascript
// 기본 다단히트 18% 고려
baseMultiHit = 18%
totalMultiHit = 18% + 스탯다단히트%

xBase = 0.18
baseDamage = 11.1×xBase + 13.9×xBase² + 17.8×xBase³ + 23.9×xBase⁴

xTotal = totalMultiHit / 100
totalDamage = 11.1×xTotal + 13.9×xTotal² + 17.8×xTotal³ + 23.9×xTotal⁴

기여도 = ((1 + totalDamage/100) / (1 + baseDamage/100) - 1) × 100
```


---

## 11. 최종 전투 점수 통합

### 11.1 계산 단계

```
Step 1: 개별 스탯 계산 및 수집
  ↓
Step 2: 각 스탯의 전투 점수 기여도 산출
  ↓
Step 3: 모든 기여도를 곱연산으로 통합
  ↓
Step 4: 공격력 적용 및 최종 점수 산출
```

### 11.2 스탯별 기여도 계산 방식

| 스탯 | 기여도 계산 |
|------|------------|
| 전투속도 | 전투속도% (그대로) |
| 무기 피해 증폭 | 무기피해증폭% × 0.66 |
| 피해 증폭 | PVE피해증폭% + 일반피해증폭% |
| 치명타 피해 증폭 | 기댓값 계산 (복잡) |
| 스킬 | 총스킬점수% (그대로) |
| 쿨타임 감소 | 이론적증가% × 0.7 |
| 강타 | 강타% (그대로) |
| 완벽 | 완벽% × 무기min/max비율 |
| 다단히트 | 기본18% 제외한 증가분 |

### 11.3 최종 통합 공식

```javascript
// 모든 기여도를 곱연산
totalMultiplier = 1.0
  × (1 + 전투속도기여도/100)
  × (1 + 무기피해증폭기여도/100)
  × (1 + 피해증폭기여도/100)
  × (1 + 치명타피해증폭기여도/100)
  × (1 + 스킬기여도/100)
  × (1 + 쿨타임기여도/100)
  × (1 + 강타기여도/100)
  × (1 + 완벽기여도/100)
  × (1 + 다단히트기여도/100)

최종_전투_점수 = 공격력 × totalMultiplier
```

### 11.4 기본 DPS vs 전투 점수

**기본 DPS (참고용):**
```javascript
baseDPS = 공격력 × (1+피해증폭) × (1+스킬) × 전투속도계수 × 쿨타임계수
finalDPS = baseDPS × (1+완벽계수) × (1+강타계수) × (1+다단히트계수)
```

**전투 점수 (실제 표시):**
```javascript
각 스탯의 기여도를 개별 계산 → 곱연산 통합 → 최종 점수
```


---

## 12. 핵심 요약

### 12.1 계산 원리

1. **독립적 계산**: 각 스탯이 독립적으로 계산됨
2. **곱연산 통합**: 모든 기여도가 곱연산으로 시너지 발생
3. **공격력 기준**: 최종적으로 공격력에 곱함
4. **캡 시스템**: 공격력 % 캡으로 밸런스 조정

### 12.2 중요 공식

```javascript
// 공격력
finalAttack = Math.floor(baseAttack × (1 + percent%/100)) + 아리엘PVE

// 전투속도/쿨감
계수 = 1 / (1 - 퍼센트%)

// 치명타 확률
확률% = (정수 × 0.7) / 10

// 다단히트
y = 11.1x + 13.9x² + 17.8x³ + 23.9x⁴

// 최종
전투점수 = 공격력 × Π(1 + 기여도/100)
```

### 12.3 설계 특징

- **비선형 증가**: 전투속도, 쿨타임, 다단히트
- **선형 합산**: 피해 증폭 (4종 합산)
- **확률 기반**: 완벽, 강타, 치명타
- **상대적 효율**: 각 스탯마다 계수 다름 (무기피해증폭 ×0.66, 쿨타임 ×0.7 등)
